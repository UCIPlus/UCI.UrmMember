# 活跃上下文

## 当前工作重点

### 正在进行的工作

**TASK001 阶段 1：基础架构配置** ✅ **已完成**（2026年1月8日）

- ✅ Memory Bank 完整初始化完成
- ✅ 项目开发规范文档建立（.github/instructions/）
- ✅ Copilot 指令配置完成
- ✅ 任务和知识管理系统建立
- ✅ TASK001 创建完成 - UCI 前端项目复刻任务
- ✅ **环境配置完成**（API 地址、超时时间）
- ✅ **Alova 实例配置完成**（支持 Token 认证）
- ✅ **API 类型定义完成**（响应结构、分页、用户类型）
- ✅ **API 模块定义完成**（认证模块、用户模块）
- ⏳ **下一步调整**：先实现不需要用户认证的页面（如站点查询、活动展示等）

### 项目当前状态

**阶段**：第一阶段 - 基础架构搭建（✅ 100%完成）

**已完成**：

- ✅ 项目脚手架初始化（基于 Wot Starter）
- ✅ 开发环境配置
- ✅ Git 仓库初始化和首次提交
- ✅ 基础目录结构建立
- ✅ 示例页面（首页、关于）
- ✅ Memory Bank 完整建立
- ✅ 开发规范文档体系建立
- ✅ 项目配置初始化（微信小程序 AppID 已配置）
- ✅ 环境配置（开发/测试/生产 API 地址）
- ✅ Alova 实例配置（Token 认证、拦截器）
- ✅ API 类型定义（core/types.ts）
- ✅ API 模块定义（auth.ts、user.ts）
- ✅ 技术决策确认（使用 Token 认证，非 JWT）

**计划调整**：

- ⏳ 暂缓认证系统开发（等待公众号测试环境就绪）
- ⏳ 优先实现无需认证的页面和功能
- ⏳ 重点开发：站点查询、营销活动、设备扫码（可选）、帮助文档等公开功能

**待开始**：

- ⏳ 优先任务：站点查询模块（地图展示、站点列表、站点详情）
- ⏳ 优先任务：营销活动模块（活动列表、活动详情、扫码领券）
- ⏳ 优先任务：通用页面（帮助中心、关于我们、用户协议等）
- ⏳ 后续：认证系统页面和组件开发（等待测试环境）
- ⏳ 后续：个人中心首页开发（需要认证）
- ⏳ 后续：优惠券系统开发（需要认证）
- ⏳ 后续：充值和消费功能开发（需要认证）

## 最近的变更

### 2026年1月8日

**上午**：

- 项目初始化完成，首次提交（commit: 7cd6208）
- 基于 Wot Starter 搭建项目基础架构
- 配置开发环境和依赖

**下午**：

- 完整建立 Memory Bank 系统
  - 核心文档：projectbrief.md, productContext.md, systemPatterns.md, techContext.md, activeContext.md, progress.md
  - README.md 作为使用指南
  - tasks/ 和 knowledge/ 目录及索引文件
- 建立项目开发规范文档（.github/instructions/）
  - overview.instructions.md - 总览
  - project-structure.instructions.md - 项目结构
  - route.instructions.md - 路由规范
  - ui-library.instructions.md - UI组件规范
  - api-development.instructions.md - API开发规范
  - state-management.instructions.md - 状态管理规范
  - styling.instructions.md - 样式开发规范
  - development-workflow.instructions.md - 工作流规范
- 建立 Copilot 指令系统（.github/prompts/）
  - imb.prompt.md - 初始化 Memory Bank
  - umb.prompt.md - 更新 Memory Bank
  - add-task.prompt.md - 添加任务
  - update-task.prompt.md - 更新任务
  - show-tasks.prompt.md - 查看任务
  - dmb.prompt.md - 禁用 Memory Bank
- 配置 Copilot 工作指令（.github/copilot-instructions.md）
- 配置项目信息
  - 微信小程序 AppID: wx6cc4bd9b379e98a6
  - 应用名称: URM Member (UCI Unified Resource Management System - Member Module)
  - 应用 ID: __UNI__9853322
- 清理原模板的 GitHub 配置（待提交）
  - 删除 FUNDING.yml, Issue/PR 模板
  - 删除 CI/CD workflow 文件

**晚上**：

- 创建 TASK001：复刻 UCI 前端项目
  - 完成原项目结构分析（`D:\UxicheWork\backend\app\uci`）
  - 识别 11 个核心功能模块
  - 制定 7 个阶段的实施计划
  - 划分 19 个子任务，预计 35-50 天完成
  - 更新 tasks/_index.md 和 activeContext.md

### 2026年1月8日（下午）

**基础架构开发完成**：

- ✅ 完成环境配置（.env.development、.env.staging、.env.production）
  - 开发环境 API：<http://localhost/api/miniapp>
  - 测试环境 API：<http://test.uci.com/api/miniapp>
  - 生产环境 API：<https://api.uci.com/api/miniapp>
  - 配置 API 超时时间：30秒
- ✅ 完成 Alova 实例配置（`src/api/core/instance.ts`）
  - 使用 uni-app 适配器
  - 配置全局拦截器
  - 实现 Token 认证（Bearer Token 方式）
  - 实现自动添加 Token 到请求头
  - 实现统一错误处理
  - 实现 401/403 自动跳转登录页
  - 实现业务状态码处理（200/401/403/500）
- ✅ 完成 API 类型定义（`src/api/core/types.ts`）
  - 定义后端响应结构（ApiResponse<T>）
  - 定义分页响应结构（PaginationResponse<T>）
  - 定义认证相关类型（WechatLoginParams、WechatLoginData）
  - 定义用户相关类型（UserInfo、UserAsset）
- ✅ 完成 API 模块定义
  - 创建 `src/api/modules/auth.ts`（认证模块）
    - 微信小程序登录 API
    - 微信公众号登录 API
    - 用户注册 API
  - 创建 `src/api/modules/user.ts`（用户模块）
    - 获取用户信息 API
    - 更新用户信息 API
    - 获取用户资产 API

**知识文档更新**：

- ✅ 创建 K001：目录结构设计文档
  - 详细的目录结构说明
  - 各目录和文件的职责说明
  - 命名规范和最佳实践

**计划调整**：

- ⏳ 暂缓认证系统开发（等待公众号测试环境就绪）
- ⏳ 调整开发优先级：先实现不需要用户认证的页面
- ⏳ 重点开发：站点查询、营销活动、帮助文档等公开功能

## 当前关注点

### 技术关注

1. **API 对接方案**
   - 需要确认后端 API 的完整接口文档
   - 需要配置 Alova 实例以对接后端
   - 需要统一错误处理和响应格式

2. **用户认证流程**
   - 微信小程序登录流程（获取 code → 换取 token）
   - 支付宝小程序登录流程
   - H5 登录流程（可能需要扫码或其他方式）
   - Token 存储和刷新机制

3. **多端适配策略**
   - 扫码功能的多端实现
   - 支付功能的多端实现
   - 地图功能的多端实现

### 业务关注

1. **功能迁移优先级**
   - 优先迁移高频功能（个人中心、优惠券查看、扫码洗车）
   - 其次迁移充值和购券功能
   - 最后迁移低频功能（推荐返佣、站点查询、营销活动）

2. **用户体验优化**
   - 页面加载速度优化
   - 交互流畅度提升
   - 错误提示友好化

## 下一步计划

### 立即行动（本周）

1. **完成 Memory Bank 初始化**
   - 完成所有核心文档的编写
   - 建立 tasks 和 knowledge 目录结构

2. **API 对接准备**
   - 获取完整的后端 API 文档
   - 配置 Alova 实例
   - 编写 API 调用示例

3. **用户认证开发**
   - 实现微信小程序登录流程
   - 实现 Token 存储和刷新机制
   - 实现路由守卫（未登录拦截）

### 短期目标（本月）

1. **核心页面开发**
   - 个人中心首页
   - 优惠券列表页（自助券、自动券、核销券）
   - 优惠券详情页

2. **基础功能实现**
   - 用户信息展示
   - 优惠券数据展示
   - 资产统计展示

### 中期目标（下月）

1. **扩展功能开发**
   - 组合购券充值
   - 消费记录查询
   - 推荐返佣

2. **支付功能集成**
   - 微信支付
   - 支付宝支付
   - 余额支付

## 当前挑战

### 技术挑战

1. **API 兼容性**
   - 原有后端 API 是为 PHP View 设计的，可能需要调整以适配前后端分离
   - 需要确认 API 的认证机制和数据格式

2. **多端差异**
   - 微信小程序、支付宝小程序、H5 的 API 差异较大
   - 需要封装统一的平台适配层

3. **状态管理**
   - 需要设计合理的状态管理方案
   - 确定哪些状态需要全局管理，哪些应该保持在组件内

### 业务挑战

1. **功能完整性**
   - 需要确保迁移后的功能与原系统完全一致
   - 需要处理原系统的历史数据和兼容性问题

2. **用户迁移**
   - 如何平滑地从原系统过渡到新系统
   - 是否需要提供两个版本并行的过渡期

## 待解决的问题

### 技术问题

1. ❓ 后端 API 的完整文档在哪里？格式如何？
2. ❓ 用户认证的具体流程是什么？需要哪些接口？
3. ❓ 是否需要实现离线缓存功能？
4. ❓ 图片资源如何管理？是否使用 CDN？
5. ❓ 如何处理微信小程序和支付宝小程序的支付差异？

### 业务问题

1. ❓ 功能迁移的优先级是否已确定？
2. ❓ 是否有设计稿或原型图？
3. ❓ 新系统上线后，原系统是否立即下线？
4. ❓ 是否需要兼容原系统的历史数据？
5. ❓ 推荐返佣的二维码生成逻辑如何实现？

## 需要的帮助

### 需要后端提供

1. 完整的 API 文档（接口地址、请求参数、响应格式）
2. 认证机制说明（如何获取和使用 Token）
3. 测试环境的 API 地址和测试账号

### 需要产品提供

1. 完整的功能清单和优先级
2. 页面设计稿或原型图
3. 用户流程图
4. 营销活动的具体规则

### 需要运维提供

1. 部署环境的配置信息
2. CDN 配置方案
3. 监控和日志方案

## 关键决策待定

### 架构决策

1. **是否使用微前端架构？**
   - 当前方案：单体应用
   - 可选方案：微前端（如果后续需要集成更多模块）

2. **是否需要 SSR（服务端渲染）？**
   - 当前方案：纯客户端渲染
   - 可选方案：SSR 提升 SEO 和首屏加载速度

3. **是否需要离线能力？**
   - 当前方案：仅在线使用
   - 可选方案：PWA 提供离线缓存

### 功能决策

1. **扫码功能如何实现？**
   - 方案 A：调用原生扫码 API
   - 方案 B：使用第三方扫码库

2. **地图功能如何实现？**
   - 方案 A：使用腾讯地图（微信小程序原生支持）
   - 方案 B：使用高德地图（需要集成 SDK）

3. **推荐二维码如何生成？**
   - 方案 A：后端生成，前端显示
   - 方案 B：前端调用小程序 API 生成

## 当前风险

### 高风险

- **API 兼容性问题**：如果后端 API 无法适配前后端分离架构，可能需要大量调整
- **功能遗漏**：原系统功能复杂，可能存在未被发现的功能点

### 中风险

- **多端差异处理**：微信小程序、支付宝小程序、H5 的 API 差异可能导致适配工作量增加
- **性能问题**：如果数据量大，可能需要额外的优化工作

### 低风险

- **第三方依赖升级**：依赖库升级可能导致兼容性问题
- **设计变更**：产品需求变更可能影响开发进度

## 上下文注意事项

### 开发时需要记住

1. **独立性原则**：不要在代码或配置中引用其他项目的路径，确保项目可以独立运行
2. **多端兼容**：编写代码时始终考虑三端（微信小程序、支付宝小程序、H5）的兼容性
3. **类型安全**：充分利用 TypeScript 的类型系统，减少运行时错误
4. **代码规范**：遵循 ESLint 规则，保持代码质量
5. **文档优先**：重要的逻辑和决策要写入 Memory Bank

### 沟通时需要明确

1. 功能需求的完整描述和边界条件
2. API 接口的详细定义（请求参数、响应格式、错误码）
3. 设计稿的具体尺寸和交互细节
4. 测试环境的访问方式和测试数据

### 测试时需要验证

1. 三端功能一致性
2. 各种网络状态下的表现（正常、慢速、离线）
3. 各种错误情况的处理（API 错误、网络错误、业务错误）
4. 边界条件和异常输入的处理

## 最近学到的经验

### 技术经验

（待补充，随着开发进展逐步积累）

### 业务经验

（待补充，随着开发进展逐步积累）

### 协作经验

（待补充，随着开发进展逐步积累）
